(()=>{"use strict";const t=e=>e.endsWith("/")?t(e.slice(0,Math.max(0,e.length-1))):e;!function(){const{open:e}=XMLHttpRequest.prototype,{send:n}=XMLHttpRequest.prototype;XMLHttpRequest.prototype.open=function(t,n,a,o,s){const r=!1===a?"sync":"async";console.info(`Preparing ${r} HTTP request : ${t} ${n}`),e.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){if(!(e instanceof FormData&&aamdPHPVariables))return void n.apply(this,arguments);const a=e.get("name");if("string"!=typeof a||!a.toLowerCase().endsWith(".lottie")&&!a.toLowerCase().endsWith(".json"))return void n.apply(this,arguments);const o=e.get("async-upload");if(!(o instanceof File))return void n.apply(this,arguments);const s=new FileReader;s.onloadend=async({target:e})=>{try{if(!(e?.result instanceof ArrayBuffer))return;const o=new Blob([e.result]),s=URL.createObjectURL(o),r=dotLottiePlayer();r.hidden=!0,document.body.appendChild(r),await r.load(s);const i=r.snapshot(!1);if(URL.revokeObjectURL(s),!i)throw new Error("Failed to create thumbnail");const p=new File([i],a.replace(/\.[^/.]+$/,".svg"),{type:"image/svg+xml"}),c=new FormData;c.append("aamd_thumbnail_submit",aamdPHPVariables.nonce),c.append("thumbnail",p);const l=await fetch((n=aamdPHPVariables.pluginUrl,`${t(n)}/includes/upload-thumbnail.php`),{body:c,method:"POST"});if(!l.ok)throw new Error(l.statusText)}catch(t){console.error(t)}var n},s.readAsArrayBuffer(o),n.apply(this,arguments)}}()})();