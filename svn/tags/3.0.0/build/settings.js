(()=>{"use strict";const e=window.React,t=window.wp.element,a=window.wp.i18n;window.wp.blob;const n=(e,t,a)=>(e.splice(a,0,e.splice(t,1)[0]),e),l=(e,t=2)=>{if(!+e)return"0 Bytes";const a=t<0?0:t,n=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,n)).toFixed(a))} ${["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}`},s=e=>{if(i(e))return e.split(".").pop()?.toLowerCase()},o=e=>`${e.replace(/\.[^.]*$/,"").replace(/\W+/g,"")}`,i=e=>{const t=e.split("/").pop()?.lastIndexOf(".");return(null!=t?t:0)>1&&e.length-1>(null!=t?t:0)},r=()=>window&&"ontouchstart"in window,c=async e=>new Promise(((t,a)=>{const n=new FileReader;n.onload=({target:e})=>{e&&"string"==typeof e.result&&t(JSON.parse(e.result))},n.onerror=e=>a(e),n.readAsText(e)})),m=(e,t=12)=>e.length>12?`${e.substring(0,t)}â€¦ `:e;function d({autoplay:a,src:n,speed:l=1,subframe:s,className:o=""}){const i=(0,t.useRef)(null),c=()=>{r()||(i.current?.setDirection(-1),i.current?.play())},m=()=>{r()||(i.current?.setDirection(1),i.current?.play())},d=(0,t.useCallback)((()=>{r()&&i.current&&(i.current.getBoundingClientRect().top<150?(i.current.setDirection(1),i.current.play()):(i.current.setDirection(-1),i.current.play()))}),[]);return(0,t.useEffect)((()=>(addEventListener("scroll",d,{passive:!0,capture:!0}),i.current&&(i.current.onmouseover=m,i.current.onmouseout=c),()=>{removeEventListener("scroll",d,!0)})),[d]),(0,e.createElement)("dotlottie-player",{autoplay:a,class:o,src:null!=n?n:"",speed:l,subframe:s,ref:i})}function u({children:a,className:n="",trigger:l}){const s=(0,t.useRef)(null),o=(0,t.useRef)(null),i=(0,t.useCallback)((()=>{const{current:e}=s,{current:t}=o;t&&e&&(e.style.maxHeight=`${t.offsetHeight}px`,e.style.minHeight=`${t.offsetHeight}px`)}),[]);return(0,t.useEffect)((()=>{i()}),[l,i]),(0,e.createElement)("div",{className:`${n} am-expandable`,ref:s},(0,e.createElement)("div",{ref:o},a))}const p=window.wp.components;function f({children:a,className:n=""}){const[l,s]=(0,t.useState)({isDragging:null,isEntered:null,prevIndex:0}),o=t.Children.map(a,(e=>(0,t.isValidElement)(e)?(0,t.cloneElement)(e,{parentState:l,setParentState:s}):e));return(0,e.createElement)("div",{className:n,onDragOver:e=>{e.preventDefault()}},o)}function h({children:a,className:l="",list:s,setList:o,id:i,parentState:r,setParentState:c}){const[m,d]=(0,t.useState)({isDragging:!1,x:0,y:0}),[u,p]=(0,t.useState)("X"),f=(0,t.useCallback)((({matches:e})=>{p(e?"Y":"X")}),[]),h=s.findIndex((({id:e})=>e===i));return(0,t.useEffect)((()=>{const e=window.matchMedia("(max-width: 760px)");return f(e),e.addEventListener("change",f),()=>{e.removeEventListener("change",f)}}),[f]),(0,e.createElement)("div",{id:i.toString(),className:`am-dragitem ${l}`,draggable:!0,style:r?.isEntered===i.toString()?{transform:`translate${u}(calc(${-(h-r.prevIndex)}00% + ${-(h-r.prevIndex)}em))`}:void 0,"data-drag":m.isDragging,"data-enter":r?.isEntered===i.toString(),onDragStart:({currentTarget:{id:e}})=>{c&&c((t=>({...t,isDragging:e,prevIndex:h}))),d((e=>({...e,isDragging:!0})))},onDragEnter:({currentTarget:{id:e}})=>{c&&c((t=>({...t,isEntered:e})))},onDragEnd:()=>{if(r?.isEntered){const e=s.findIndex((({id:e})=>e.toString()===r.isEntered));o((t=>n([...t],h,e)))}d({isDragging:!1,x:0,y:0}),c&&c({isEntered:null,isDragging:null,prevIndex:0})}},a)}function g({files:n,setFiles:l,setNotice:o,uploadLottie:i}){const[r,c]=(0,t.useState)(),d=n.map((({name:e})=>e)).join("_"),u=async e=>{const t=n.map((({id:e,url:t})=>({id:e.toString(),url:t})));try{const s=r&&encodeURIComponent(r.replace(/\s/g,"-")).toLowerCase()||d,c=await dotLottiePlayer().addAnimation(t,s,!!e);c?await i(c,s):(o({show:!0,status:"success",message:(0,a.sprintf)((0,a._n)("%s file was combined to 1 dotLottie, and downloaded successfully","%s files was combined to 1 dotLottie, and downloaded successfully",n.length,"am-lottieplayer"),n.length)}),setTimeout((()=>{l([])}),500))}catch(e){o({show:!0,status:"error",message:(0,a.__)("There was an error","am-lottieplayer")})}};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"content"},(0,e.createElement)("h3",null,(0,a.__)("Animations to combine","am-lottieplayer")),(0,e.createElement)("p",null,(0,a.__)("Place the animations in the order you want them to appear. Use drag to change the order.","am-lottieplayer"))),(0,e.createElement)(f,{className:"am-files"},n.map((({alt:t,filename:a,icon:o,id:i,filesizeHumanReadable:r,name:c},d)=>(0,e.createElement)(h,{key:i,id:i,list:n,setList:l,className:"am-file am-combine"},(0,e.createElement)("button",{className:"am-remove media-modal-close",onClick:()=>{l((e=>e.filter((e=>e.id!==i))))}},(0,e.createElement)("span",{className:"media-modal-icon"})),(0,e.createElement)("img",{src:o,alt:t}),(0,e.createElement)("span",{className:"am-order"},d+1),(0,e.createElement)("p",null,m(c,8),s(a)?`.${s(a)} `:" ",(0,e.createElement)("span",{className:"am-size"},r)))))),n.length>1?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"am-button-wrapper combine-files"},(0,e.createElement)("fieldset",{className:"am-fieldset"},(0,e.createElement)("label",{className:"am-label",htmlFor:"am-lottieplayer-filename"},(0,a.__)("File name","am-lottieplayer")),(0,e.createElement)("input",{id:"am-lottieplayer-filename",className:"am-input",name:"fileName",value:r,onChange:({target:e})=>c(e.value),type:"text",placeholder:`${d}.lottie`})),(0,e.createElement)("button",{onClick:()=>{u(!0)},className:"am-btn small white"},(0,e.createElement)("span",{className:"dashicons dashicons-download"})," ",(0,a.__)("Combine and download")),(0,e.createElement)("button",{onClick:()=>{u(!1)},className:"am-btn small blue"},(0,e.createElement)("span",{className:"dashicons dashicons-cloud-saved"})," ",(0,a.__)("Combine and add to Media Library","am-lottieplayer")))):(0,e.createElement)(p.Notice,{status:"info",isDismissible:!1},(0,a.__)("You need to select 2 or more animations","am-lottieplayer")))}function y({files:t,setFiles:n,setNotice:l,uploadLottie:o,wrongType:i}){const r=({mime:e})=>"application/json"!==e.toLowerCase(),c=async e=>{const s=[];try{for(const a of t)if(r(a))i();else{if(!a.lottieJSON.length){const e=await fetch(a.url);if(e.ok){const t=await e.json();t&&"object"==typeof t&&a.lottieJSON.push(t)}}s.push(new Promise((t=>{const n=dotLottiePlayer().convert(!1,{animations:[{id:a.id.toString()}]},a.lottieJSON,a.name,e);n?.then((e=>{e&&o(e,a.name).then((()=>t()))})),t()})))}return await Promise.all(s),l({show:!0,status:"success",message:e?(0,a.sprintf)((0,a._n)("%s file was successfully converted and downloaded","%s files was uccessfully converted and downloaded",t.length,"am-lottieplayer"),t.length):(0,a.sprintf)((0,a._n)("%s file was successfully converted","%s files was uccessfully converted",t.length,"am-lottieplayer"),t.length)}),n([])}catch(e){return l({show:!0,status:"error",message:(0,a.__)("Failed to convert file","am-lottieplayer")})}};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h3",null,(0,a.__)("Animations to convert","am-lottieplayer")),(0,e.createElement)("div",{className:"am-files"},t.map((({alt:t,icon:a,id:l,filename:o,filesizeHumanReadable:i,name:r})=>(0,e.createElement)("div",{key:l,className:"am-file"},(0,e.createElement)("button",{className:"am-remove media-modal-close",onClick:()=>{n((e=>e.filter((e=>e.id!==l))))}},(0,e.createElement)("span",{className:"media-modal-icon"})),(0,e.createElement)("img",{src:a,alt:t}),(0,e.createElement)("p",null,m(r,8),s(o)?`.${s(o)} `:" ",(0,e.createElement)("span",{className:"am-size"},i)))))),!!t.length&&(0,e.createElement)("div",{className:"am-button-wrapper convert-files"},(0,e.createElement)("button",{onClick:()=>{c(!0)},className:"am-btn small white"},(0,e.createElement)("span",{className:"dashicons dashicons-download"})," ",(0,a.__)("Convert and download")),(0,e.createElement)("button",{onClick:()=>{c(!1)},className:"am-btn small blue"},(0,e.createElement)("span",{className:"dashicons dashicons-cloud-saved"})," ",(0,a.__)("Convert and save to Media Library","am-lottieplayer"))))}function E({children:n,className:l="",onDrop:s}){const[o,i]=(0,t.useState)(!1),r=e=>{e.preventDefault(),e.stopPropagation()};return(0,e.createElement)("div",{onDrag:e=>r(e),onDragStart:e=>r(e),onDragEnd:e=>r(e),onDragOver:e=>r(e),onDragEnter:e=>{r(e),i(!0)},onDragLeave:e=>{r(e),i(!1)},onDrop:e=>{r(e),s(e),i(!1)},className:`${l} am-dropzone`,"data-hasDragOver":o},(0,e.createElement)("div",{className:"am-dropzone-instructions"},(0,e.createElement)("span",null,(0,a.__)("Drop it like it's hot!","am-lottieplayer"))),n)}function b({id:n,instructions:i,multiple:r=!1,context:m="combine",type:d,setNotice:p}){const f=(0,t.useId)(),h=n||f,{endpoint:b,nonce:w}=amPhpVars,v={mime:"combine"===m?["application/json","application/zip"]:["application/json"],extension:"combine"===m?[".lottie",".json"]:[".json"]},_=(e,t)=>{var a;return v.mime.includes(e.toLowerCase())||v.extension.includes(`.${null!==(a=s(t))&&void 0!==a?a:""}`)},N=()=>{p({show:!0,status:"error",message:"combine"===m?(0,a.__)("Only JSON and dotLottie files allowed","am-lottieplayer"):(0,a.__)("Only JSON files allowed","am-lottieplayer")})},[L,S]=(0,t.useState)([]),k=(0,t.useRef)(null),{pluginUrl:C}=amPhpVars,{media:D}=wp,x=async e=>{const t=Array.from(e);if(!t.every((({type:e,name:t})=>_(e,t))))return N();const a=[];for(const e of t)"application/json"===e.type&&a.push(await c(e));S((e=>[...e,...t.map(((e,t)=>{const n=o(e.name),s=e.type.split("/");return{title:n,name:n,mime:e.type,filename:encodeURIComponent(e.name).toLowerCase(),filesizeInBytes:e.size,filesizeHumanReadable:l(e.size,0),icon:C+"assets/lottie-icon.svg",id:Math.floor(1e4*Math.random()+1),lottieJSON:[a[t]],url:URL.createObjectURL(e),type:s[0],subtype:s[1]}}))]))},F=async(e,t)=>{const n=new FormData;n.append("file",new Blob([e],{type:"application/zip"}),`${t}.lottie`),(await fetch(b,{method:"POST",credentials:"same-origin",body:n,headers:{"X-WP-Nonce":w}})).ok?(p({show:!0,status:"success",message:(0,a.sprintf)((0,a._n)("%s file uploaded successfully","%s files uploaded successfully","combine"===m?1:L.length,"am-lottieplayer"),"combine"===m?1:L.length)}),setTimeout((()=>{S([])}),500)):p({show:!0,status:"error",message:(0,a.__)("Error while uploading file","am-lottieplayer")})};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(u,{className:"am-selected",trigger:L},!!L?.length&&("combine"===m?(0,e.createElement)(g,{files:L,setFiles:S,setNotice:p,uploadLottie:F}):(0,e.createElement)(y,{files:L,setFiles:S,setNotice:p,uploadLottie:F,wrongType:N}))),(0,e.createElement)(E,{className:"am-lottieplayer-upload",onDrop:({dataTransfer:{files:e}})=>{x(e)}},(0,e.createElement)("div",{className:"inner"},(0,e.createElement)("h2",null,(0,a.__)("Drop files to upload")),(0,e.createElement)("p",null,(0,a.__)("or")),(0,e.createElement)("input",{id:h,type:"file",accept:v.extension.join(","),multiple:r,onChange:({target:{files:e}})=>{e&&x(e)}}),(0,e.createElement)("div",{className:"am-button-wrapper"},(0,e.createElement)("label",{className:"am-btn white",htmlFor:h},(0,a.__)("Select Files")),(0,e.createElement)("button",{onClick:e=>(e.preventDefault(),k.current||(k.current=D({title:null!=i?i:(0,a.__)("Select or upload Lottie","am-lottieplayer"),button:{text:(0,a.__)("Use")},multiple:r,library:{type:d}}),k.current.on("select",(()=>{const e=k.current?.state().get("selection");if(e)for(const t of e){const e=t.toJSON();if(!_(e.mime,e.filename))return N();e.lottieJSON=[],S((t=>[...t,e]))}}))),k.current.open()),className:"am-btn blue"},(0,a.__)("Media Library"))))))}function w(){const[n,l]=(0,t.useState)(1),[s,o]=(0,t.useState)({show:!1,status:"success",message:(0,a.__)("AM LottiePlayer","am-lottieplayer")}),{pluginUrl:i}=amPhpVars;return(0,t.useEffect)((()=>{s.show&&(setTimeout((()=>{document.querySelector(".am-main-notice-element")?.scrollIntoView({behavior:"smooth",block:"center"})}),100),"success"===s.status&&setTimeout((()=>{o((e=>({...e,show:!1})))}),6e3))}),[s.show,s.status]),(0,e.createElement)("section",{className:"am-settings"},(0,e.createElement)("header",{className:"am-header"},(0,e.createElement)(d,{autoplay:!0,src:`${i}assets/banner_top.lottie`})),(0,e.createElement)("main",null,(0,e.createElement)("div",{className:"content"},(0,e.createElement)("p",null,(0,a.__)("We love cool looking, fast loading web sites, and we're glad you do to.","am-lottieplayer")),(0,e.createElement)("p",{dangerouslySetInnerHTML:{__html:(0,a.sprintf)(
// translators: %s: href
// translators: %s: href
(0,a.__)('For documentation and inspiration, visit <a href="%s" target="_blank" rel="noreferrer">this plugins\'s homepage</a>. Feel free to <a href="mailto:johan@aarstein.media" target="_blank" rel="noreferrer">contact us</a> if you have any feature requests or other feedback. Have fun designing!',"am-lottieplayer"),"https://www.aarstein.media/en/am-lottieplayer")}})),(0,e.createElement)("div",{className:"block-tabs"},(0,e.createElement)("button",{onClick:()=>l(1),"data-active":1===n,className:"block-tab"},(0,e.createElement)("span",{className:"dashicons dashicons-admin-generic"})," ",(0,a.__)("Combine Animations","am-lottieplayer")),(0,e.createElement)("button",{onClick:()=>l(2),"data-active":2===n,className:"block-tab"},(0,e.createElement)("span",{className:"dashicons dashicons-update"})," ",(0,a.__)("Convert to JSON to dotLottie","am-lottieplayer")),(0,e.createElement)("button",{onClick:()=>l(3),"data-active":3===n,className:"block-tab"},(0,e.createElement)("span",{className:"dashicons dashicons-admin-settings"})," ",(0,a.__)("Settings","am-lottieplayer"))),(0,e.createElement)("div",{className:"content-tabs"},(0,e.createElement)("div",{className:"content-tab","data-active":1===n},(0,e.createElement)("div",{className:"content"},(0,e.createElement)("p",null,(0,a.__)("Combine two or more Lottie animations in a single dotLottie file. This is useful if you want to differentiate animations on descrete user interactions, or if you want the end user to be able to easily toggle between animations.","am-lottieplayer"))),(0,e.createElement)(b,{instructions:(0,a.__)("Choose animations to combine","am-lottieplayer"),multiple:!0,type:["application/zip","application/json"],context:"combine",setNotice:o})),(0,e.createElement)("div",{className:"content-tab","data-active":2===n},(0,e.createElement)("div",{className:"content"},(0,e.createElement)("p",null,(0,a.__)("If you have a JSON Lottie animation, there are advantages to converting it into a dotLottie. First there's the compression, making the animation lighter and faster to load. Then there's the practicallity of having a descrete file extension. Last there's the possibility to combine several Lottie animations in a single file.","am-lottieplayer"))),(0,e.createElement)(b,{instructions:(0,a.__)("Choose JSON Lotties to convert to dotLottie","am-lottieplayer"),type:["application/json"],context:"convert",multiple:!0,setNotice:o})),(0,e.createElement)("div",{className:"content-tab","data-active":3===n},(0,e.createElement)("div",{className:"content"},(0,e.createElement)("h2",null,(0,e.createElement)("span",{className:"dashicons dashicons-admin-network"})," ",(0,a.__)("License","am-lottieplayer")),(0,e.createElement)("p",{dangerouslySetInnerHTML:{__html:(0,a.sprintf)(
// translators: %s: href
// translators: %s: href
(0,a.__)('To unlock updates, please enter your license key below. If you don\'t have a licence key, please see <a href="%s" target="_blank" rel="noreferrer">details & pricing</a>.',"am-lottieplayer"),"https://www.aarstein.media/en/am-lottieplayer/pro")}})),(0,e.createElement)("hr",{style:{margin:"1.3em 0",width:"100%",border:"0",display:"block"}}),(0,e.createElement)("h2",null,(0,e.createElement)("span",{className:"dashicons dashicons-admin-generic"})," ",(0,a.__)("Auto-optimize script on front-end","am-lottieplayer")),(0,e.createElement)("p",null,(0,a.__)("When enabled AM LottiePlayer Pro will automatically decide whether to load light or full version of front-end script, based on your animation settings. If you disable this, the full version will always be loaded. If you experience any problems with the animation on the front-end, it might help to disable this setting.","am-lottieplayer"))))))}const v=document.getElementById("am-lottieplayer-settings");v&&(0,t.render)((0,e.createElement)((()=>(0,e.createElement)(w,null)),null),v)})();